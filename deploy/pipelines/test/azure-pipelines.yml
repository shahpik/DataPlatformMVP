trigger:
- master

stages:
- stage: Build
  displayName: 'Build Azure Data Services'
  jobs:
  - template: azure-pipelines-build-template.yml


- stage: DeployTest
  displayName: 'Deploy Azure Data Services to Test environment'
  condition: succeeded()
  dependsOn: Build
  variables:
  - group: 'rm-data-tst-variable-group'
  jobs:
  - template: azure-pipelines-deployment-template.yml
    parameters:
      azureServiceConnection: '$(AzureSvcConnection)'
      rg: $(ResourceGroup)
      region: $(Region)
      environment: 'test'
      keyVaultData: $(KeyVaultData)
      keyVaultMl: $(KeyVaultML)