trigger:
- master

variables:
  - group: 'rm-az-connection-variable-group'

stages:
- stage: Build
  displayName: 'Build Azure Data Services'
  jobs:
  - template: azure-pipelines-build-template.yml


- stage: DeployDev
  displayName: 'Deploy Dev Environment Azure Data Services'
  condition: succeeded()
  dependsOn: Build
  variables:
  - group: 'rm-edp-dev-variable-group'
  jobs:
  - template: azure-pipelines-deployment-template.yml
    parameters:
      azureServiceConnection: '$(AzureServiceConnection_Dev)'
      environment: 'Dev'
      resourceTagsFilePath: '$(Pipeline.Workspace)/deploy/pipelines/data/v1/resourceTags/env.dev.json'


- stage: DeployProd
  displayName: 'Deploy Production Environment Azure Data Services'
  condition: succeeded()
  dependsOn: DeployDev
  variables:
  - group: 'rm-edp-prod-variable-group'
  jobs:
  - template: azure-pipelines-deployment-template.yml
    parameters:
      azureServiceConnection: '$(AzureServiceConnection_Prod)'
      environment: 'Prod'
      resourceTagsFilePath: '$(Pipeline.Workspace)/deploy/pipelines/data/v1/resourceTags/env.prod.json'